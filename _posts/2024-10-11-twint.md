---
layout: post
title: Does crime pay? 
subtitle: Forensic analysis of the Swiss instant payment application Twint
tags: [mobile forensics, phone app, case study]
comments: true
mathjax: true
author: Evan Blezinger, Simone Damian, Kévin Dubois, Vladimir Pfister, Frank Ressat, Alexandre Vallotton
---
During our master's mobile forensics course, we had to work on an exciting project focused on a specific iOS application. The project was so engaging and insightful that we decided to turn it into a blog post.

## Synopsis:

**Forensics Question:**  
This case study examines digital traces of money transactions generated by the usage of the Twint Prepaid application.

- **OS Version:**
  - iOS version 15.1.0
  - Twint Prepaid version 30.1.1

- **Tools:**  
  - UFED 4PC version 7.59.0.128
  - Cellebrite Physical Analyzer version 7.57.0.51
  - DB Browser version 3.12.2

### What is Twint?
Twint is an instant payment application, which is only available in Switzerland. It is wildly used all over the country and permits quick monetary exchanges between users in Swiss Francs (CHF), as well as allowing them to quickly make payments by scanning a specific QR code or by connecting the device with a Beacon station via Bluetooth connection. 

<div style="text-align: center;">
  <img src="https://KefreR.github.io/assets/img/twint_app.PNG" alt="twint_app" width="600"/>
</div>

**Figure 1**: The Twint prepaid app on [app store](https://apps.apple.com/ch/app/prepaid-twint-other-banks/id1001116392?l=en-GB).

There are several versions of the application depending on the Swiss bank the user is linked to. However, users can install a prepaid version of Twint which is not affiliated with any bank. This latter has been chosen for this case study. Thus, making possible the creation of an account without linking it to any bank.

### Goal of the Study
In forensic investigations, getting information on the different payment transactions that happened between different individuals can be very useful to reinforce the investigative hypotheseis. The analysis of banking apps has already been performed to successfully gather this kind of information. However, still nothing has been done regarding Twint’s specific artifacts.  

The goal of this study is to determine what kind of transaction data generated using the Twint application can be collected on iPhone 8  devices, as well as establish what useful knowledge regarding digital investigation can be provided. The purpose is to first analyze the data created on the device’s memorystorage by the application when performing all sorts of transactions.

## Methodology
First, the prepaid version 30.1.1 of Twint application is downloaded on an iPhone 8 test device, model A1905 with iOS version 15.1.0. 
In this case study, an inductive reasoning approach is set up. To keep track of the different parameters, all the procedures applied throughout the analysis are documented to maintain a chain of custody of the operations. 
It is then possible to link the activities carried out on the smartphone to the traces collected. 
Once the application is set up within the creation of a test user on the test device, it is used to perform different activities. 
In this regard, the vast majority of Twint functionalities are used and documented together with relative timestamps. 
Once all the activities are performed and the data is consecutively generated on the test device’s storage, the forensic tool UFED 4PC version 7.59.0.128 was used for a file system level of checkm8 exploit. 
Then Cellebrite Physical Analyzer version 7.57.0.51 paired with DB Browser version 3.12.2 has been exploited for the review and analysis. 

<div style="text-align: center;">
  <img src="https://KefreR.github.io/assets/img/twint_transaction.png" alt="twint_transac" width="300"/>
  <img src="https://KefreR.github.io/assets/img/twint_transaction2.png" alt="twint_transac2" width="300"/>
</div>

**Figure 2**: Examples of activities (transactions) performed

For the purpose of the study, it is necessary to have access to the file system-level data rather than snippets of data. 
To do so, file system level of extraction was performed using the checkm8 exploit of the forensic tool. 
The full analysis of the image allows the discovery of folders and files of interest which will then be analyzed more in more depth.  
The file targeting step is done by identifying the specific GUID number of the Twint app. 
A database stored by default in the device’s memory storage contains information on all the device’s installed applications, as such as their name and respective data folder. 

The database is then filtered using some various SQL requests which returned the Twint-related files of interest. 
These files are then opened with a hexadecimal reader to directly retrieve their specific GUID number.

Finally, the analysis step consists of looking at the data contained in the targeted files and linking it to the activities. 
Indeed, the documentation of the activities establishes anchor points on which to base this link (for example, the timestamp when the transaction is made). 
The analyzed data comes in different types of formats and may contain useful information as not. 
Therefore, there is no specific tool or method used to detect the pertinent data. 
For this reason, it is essential to go through all the data contained in the files of interest not to miss any useful information. 
This results in a time-consuming process which guarantees an exhaustive analysis of each targeted file.  

<div style="text-align: center;">
  <img src="https://KefreR.github.io/assets/img/methodo.png" alt="methodo" width="600"/>
</div>


**Figure 3**: Diagram of the methodology applied

## Results & Artifacts
A key file, `Twint.sqlite`, was discovered. The `ZTRANSACTION` table logs all transactions, and its columns were analyzed based on the established anchor points.

### Important Columns in `ZTRANSACTION` table:
- **ZCREATIONDATE**: Timestamp of transaction creation (Apple Absolute Time +1 format).
- **ZMODIFIEDTIMESTAMP**: Timestamp of transaction confirmation.
- **ZSECONDPHASETIMESTAMP**: Timestamp when the response was received by the receiving phone.
- **ZMERCHANTNAME**: Name of the merchant receiving the transaction (e.g., Kiosk, Coop).
- **ZP2PSENDERMOBILENR**: Phone number of the sender.
- **ZP2PINIATEMESSAGE**: Message sent during the transaction initiation.
- **ZP2PRECIPIENTMOBILENR**: Phone number of the transaction recipient.
- **ZP2PRECIPIENTNAME**: Name of the transaction recipient.
- **ZP2PREPLYMESSAGE**: Response message to the transaction initiation.
- **ZAUTHORIZEDAMOUNT**: Authorized amount for the transaction (NULL if rejected).
- **ZPAIDAMOUNT**: Paid amount (NULL for rejected transactions).
- **ZREQUESTEDAMOUNT**: Requested amount, even if rejected.
- **ZCURRENCY**: Currency used in the transaction.
- **ZCONTENTREFERENCE**: Reference to multimedia content (e.g., GIF).
- **ZORDERSTATEVALUE**: Status of the transaction (e.g., finalized, rejected, awaiting confirmation).
- **ZORDERTYPEVALUE**: Type of transaction (e.g., between individuals or organizations).
- **ZP2PHASPICTURE**: Indicates the presence of media in the transaction.
- **ZTRANSACTIONIDEVALUE**: Indicates if the transaction is a cash inflow or outflow.
- **ZMERCHANTCONFIRMATION**: Indicates if merchant confirmation is required.
- **ZMERCHANTTRANSACTIONREF**: Transaction number generated by an organization.
- **ZORDERUUIDSTRING**: Order ID generated by an organization.

## Discussion & Mitigation
### Volatility
This study has been realised in a short period of time. In fact, only one week passed between the first activity and the analyse of the extracted data. Also, only few activities were performed on the application. 
Thus, it is not possible to determine if the collected data could be discarded in presence of too many entries or possibly fade over time especially concerning all the data found in Twint.sqlite’s transaction database.
Generally, evaluation of the volatility of digital and physical traces over time is an important challenge in all kinds of forensic analysis.

### Relevance
Beacon payments with Twint suggest location data since they require a Bluetooth connection, implying proximity to the payment terminal. However, extracting precise location information requires linking the terminal's physical address to transaction data in the Twint.sqlite database.
Notably, QR code transactions may not accurately reflect device location. For instance, a QR code for parking might be scanned from a previously taken photo rather than on-site. This demonstrates that QR payments aren’t always tied to the actual location, emphasizing the need for careful evaluation of location traces in digital transactions.

## Future work
#### Bank related version
Twint’s instant payment application has the particularity of existing in several forms, depending on the user's bank (e.g., Twint BCV, Twint UBS or Twint Raiffeisen). 
For this review, the prepaid version of the application has been analyzed to avoid the process of creating a specific bank account. 
Then it would be interesting to perform the same digital forensic analysis by targeting traces generated from activities performed on the bank-related versions of the application. 
This would be interesting to compare the observed results (and so the utility of a disposing of well-made documentation to repeat working environments and conditions and guarantee a correct comparison of observed results).
In this case, the main question would be if the observed results would be the same or not, and more specifically if additional information linked to the bank account can be detected. 
For example, in the Twint.sqlite database, a table named **ZIBAN** is observed, and could possibly contain bank account-related data. 
If it’s the case, such information could be useful to identify the user.

#### What about Android?
Moreover, analysis was done on an iOS device, it would then be interesting to perform this case study on an Android device to see the differences and similarities.

#### Is backup an option?
Finally, it would be interesting to set up a backup extraction to determine whether the data analyzed is available in this case.
This type of extraction is easier and less time consuming thus making the process less resource intensive.

### iLeap integration
Our findings were implemented on the [iLeap](https://github.com/abrignoni/iLEAPP/tree/main) open source project. Making it now possible to retrieve Twint prepraid data using this tool.

(Figure 3: Content of `P2PRECIPIENTMOBILENR` column)  
(Figure 4: Content of `ZP2PRECIPIENTNAME` column)

### SQL Query to Extract Data:
```sql
SELECT
  ZTRANSACTION.Z_PK,
  datetime(ZTRANSACTION.ZCREATIONDATE + 978307200, 'UNIXEPOCH', 'LOCALTIME'),
  datetime(ZTRANSACTION.ZMODIFIEDTIMESTAMP + 978307200, 'UNIXEPOCH', 'LOCALTIME'),
  datetime(ZTRANSACTION.ZSECONDPHASETIMESTAMP + 978307200, 'UNIXEPOCH', 'LOCALTIME'),
  ZTRANSACTION.ZMERCHANTNAME,
  ZTRANSACTION.ZP2PSENDERMOBILENR,
  ZTRANSACTION.ZP2PINITIATEMESSAGE,
  ZTRANSACTION.ZP2PRECIPIENTMOBILENR,
  ZTRANSACTION.ZP2PRECIPIENTNAME,
  ZTRANSACTION.ZP2PREPLYMESSAGE,
  ZTRANSACTION.ZAUTHORIZEDAMOUNT,
  ZTRANSACTION.ZPAIDAMOUNT,
  ZTRANSACTION.ZREQUESTEDAMOUNT,
  ZTRANSACTION.ZCURRENCY,
  ZTRANSACTION.ZCONTENTREFERENCE,
  ZTRANSACTION.ZCONTENTREFERENCESOURCEVALUE,
  ZTRANSACTION.ZORDERSTATEVALUE,
  ZTRANSACTION.ZORDERTYPEVALUE,
  ZTRANSACTION.ZP2PHASPICTURE,
  ZTRANSACTION.ZTRANSACTIONSIDEVALUE,
  ZTRANSACTION.ZMERCHANTTRANSACTIONREF,
  ZTRANSACTION.ZORDERUUIDSTRING,
  ZTRANSACTION.ZMERCHANTCONFIRMATION
FROM ZTRANSACTION;
```
